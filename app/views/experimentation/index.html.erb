<%= render 'shared/page_heading', title: "Self-Experimentation", description: "Is it time for a change? Based on your past reflections and self-reports you can experiment with the settings of your existing habits, add and remove habits." do %>
<% end %>

<div class="flex flex-row pb-4 mb-4">
  <div class="grid grid-cols-3 gap-4">
    <div class="rounded border border-gray-100 bg-gray-50 p-4">
      <div class="font-medium text-gray-700 text-xs">
        Current Period
      </div>
      <div class="mt-2 text-lg font-semibold text-gray-800">
        Last 7 days
      </div>

      <div class="mt-2 font-medium text-gray-600 text-xs">
        <%= @current_period_start.to_date.strftime("%d.%m.%y") %> <%= " - " + @current_period_end.strftime("%d.%m.%y") %>
      </div>
    </div>
    <% if @has_data_before_start_date %>

      <div class="rounded border border-gray-100 bg-gray-50 p-4">
        <div class="font-medium text-gray-700 text-xs">
          Previous Period
        </div>
        <div class="mt-2 text-lg font-semibold text-gray-800">
          Previous 7 days
        </div>

        <div class="mt-2 font-medium text-gray-600 text-xs">
          <%= @first_reflection_at.to_date.strftime("%d.%m.%y") %> <%= " - " + @start_datetime.to_date.strftime("%d.%m.%y") %>
        </div>
      </div>

    <% end %>
  </div>
</div>

<div class="flow-root">
  <% @goals.each do |goal| %>
    <div class="flex flex-row">
      <div class="flex-grow">
        <h2 class="text-2xl font-serif mb-0"><i class="far fa-bullseye-arrow text-xl mx-auto"></i> <%= goal.title %></h2>
        <% goal.experience_sample_configs.each do |self_report| %>
          <%= render "self_report_chart_header", self_report: self_report %>
          <%= render "self_report_chart", self_report: self_report %>
        <% end %>
        <%= render partial: "habit", collection: goal.habits %>
      </div>
    </div>
  <% end %>
</div>
